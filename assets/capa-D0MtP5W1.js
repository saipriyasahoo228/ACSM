import{r as h,j as e,R as L}from"./index-lQRenEQZ.js";import{B as E,C as z,T as m,a as P,b as S,c as i,d as s,e as y}from"./TableRow-DOrBXlsl.js";import{C as N}from"./CardHeader-CVfYXhzf.js";import{C as M}from"./CardContent-B105ua6l.js";import{I as g}from"./IconButton-T04wkc8J.js";import{E as H}from"./ExpandLess-DZ7dPrMJ.js";import{E as K}from"./ExpandMore-CUYkeq_0.js";import{C as V}from"./Collapse-BxTKEx5z.js";import{T as o}from"./TextField-DSnqcXEl.js";import{B as C}from"./Modal-B5kKy10H.js";import{C as _}from"./Chip-Ds2TcdWV.js";import{E as q}from"./Edit-C-2-cLNF.js";import{D as G}from"./Delete-CGINWn67.js";import{D as J,a as Q,b as U,c as X}from"./DialogTitle-BY4vkXbS.js";import{S as Y}from"./Stack-CbGqEpRV.js";import{M as d}from"./MenuItem-C9agow_O.js";import"./clsx-B-dksMZM.js";import"./ButtonBase-DbGEVCCx.js";import"./TransitionGroupContext-Cr6fGhL9.js";import"./Transition-CaP-LOaf.js";import"./InputLabel-D6fBawzD.js";import"./Select-BG3pRAtK.js";import"./index-BGy4LR6Y.js";import"./isMuiElement-CkiPPDrS.js";import"./dividerClasses-HdBjWpbl.js";const Ee=()=>{const[x,p]=h.useState([{id:"INC001",category:"Near-Miss",date:"2025-10-17",location:"Site A",rca:"",capas:[]},{id:"INC002",category:"LTI",date:"2025-10-16",location:"Site B",rca:"",capas:[]}]),[f,I]=h.useState([]),[W,A]=h.useState(!1),[c,b]=h.useState(null),[n,v]=h.useState({type:"Corrective",description:"",owner:"",startDate:"",dueDate:"",status:"Pending"}),w=["Ravi Kumar","Sita Das","Amit Roy","Priya Sharma","Rahul Verma"],R=t=>{I(r=>r.includes(t)?r.filter(a=>a!==t):[...r,t])},D=(t,r=null,a=null)=>{b({incident:t,capa:r,index:a}),v(r||{type:"Corrective",description:"",owner:"",startDate:"",dueDate:"",status:"Pending"}),A(!0)},j=()=>{A(!1),b(null)},u=t=>{v({...n,[t.target.name]:t.target.value})},T=()=>{const t=x.map(r=>{if(r.id===c.incident.id){let a=[...r.capas];return c.capa?a[c.index]=n:a.push(n),{...r,capas:a}}return r});p(t),j()},k=(t,r)=>{const a=x.map(l=>{if(l.id===t){const B=l.capas.filter((Z,F)=>F!==r);return{...l,capas:B}}return l});p(a)},O=t=>{switch(t){case"Completed":return"success";case"In Progress":return"warning";case"Pending":return"default";case"Overdue":return"error";default:return"default"}};return e.jsxs(E,{sx:{p:3},children:[e.jsxs(z,{sx:{borderLeft:"6px solid #0A3A6E",borderRadius:2,boxShadow:"0 4px 12px rgba(0,0,0,0.1)"},children:[e.jsx(N,{title:e.jsx(m,{variant:"h6",sx:{color:"#0A3A6E",fontWeight:"bold"},children:"Incident Investigation & CAPA"})}),e.jsx(M,{children:e.jsxs(P,{children:[e.jsx(S,{children:e.jsxs(i,{sx:{background:"#E3F2FD"},children:[e.jsx(s,{}),e.jsx(s,{sx:{fontWeight:"bold",color:"#0A3A6E"},children:"Incident ID"}),e.jsx(s,{sx:{fontWeight:"bold",color:"#0A3A6E"},children:"Category"}),e.jsx(s,{sx:{fontWeight:"bold",color:"#0A3A6E"},children:"Date"}),e.jsx(s,{sx:{fontWeight:"bold",color:"#0A3A6E"},children:"Location"})]})}),e.jsxs(y,{children:[x.map(t=>e.jsxs(L.Fragment,{children:[e.jsxs(i,{children:[e.jsx(s,{children:e.jsx(g,{size:"small",onClick:()=>R(t.id),children:f.includes(t.id)?e.jsx(H,{}):e.jsx(K,{})})}),e.jsx(s,{children:t.id}),e.jsx(s,{children:t.category}),e.jsx(s,{children:t.date}),e.jsx(s,{children:t.location})]}),e.jsx(i,{children:e.jsx(s,{colSpan:5,sx:{p:0,border:"none"},children:e.jsx(V,{in:f.includes(t.id),timeout:"auto",unmountOnExit:!0,children:e.jsxs(E,{sx:{p:2,background:"#fdf9f5",borderRadius:1},children:[e.jsx(m,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:"Root Cause Analysis"}),e.jsx(o,{multiline:!0,rows:3,fullWidth:!0,value:t.rca,onChange:r=>{const a=x.map(l=>l.id===t.id?{...l,rca:r.target.value}:l);p(a)}}),e.jsx(m,{variant:"subtitle1",sx:{fontWeight:"bold",mt:2},children:"CAPAs"}),e.jsx(C,{variant:"contained",sx:{mt:1,mb:1,bgcolor:"#0A3A6E"},onClick:()=>D(t),children:"+ Add CAPA"}),e.jsxs(P,{size:"small",children:[e.jsx(S,{children:e.jsxs(i,{sx:{background:"#E8F5E9"},children:[e.jsx(s,{children:"Type"}),e.jsx(s,{children:"Description"}),e.jsx(s,{children:"Owner"}),e.jsx(s,{children:"Start Date"}),e.jsx(s,{children:"Due Date"}),e.jsx(s,{children:"Status"}),e.jsx(s,{children:"Actions"})]})}),e.jsxs(y,{children:[t.capas.map((r,a)=>e.jsxs(i,{children:[e.jsx(s,{children:r.type}),e.jsx(s,{children:r.description}),e.jsx(s,{children:r.owner}),e.jsx(s,{children:r.startDate}),e.jsx(s,{children:r.dueDate}),e.jsx(s,{children:e.jsx(_,{label:r.status,color:O(r.status),size:"small"})}),e.jsxs(s,{children:[e.jsx(g,{size:"small",onClick:()=>D(t,r,a),children:e.jsx(q,{})}),e.jsx(g,{size:"small",onClick:()=>k(t.id,a),children:e.jsx(G,{})})]})]},a)),t.capas.length===0&&e.jsx(i,{children:e.jsx(s,{colSpan:7,align:"center",children:"No CAPAs added."})})]})]})]})})})})]},t.id)),x.length===0&&e.jsx(i,{children:e.jsx(s,{colSpan:5,align:"center",children:"No incidents found."})})]})]})})]}),e.jsxs(J,{open:W,onClose:j,fullWidth:!0,maxWidth:"sm",children:[e.jsx(Q,{sx:{bgcolor:"#0A3A6E",color:"#fff",fontWeight:"bold"},children:c!=null&&c.capa?"Edit CAPA":"Add CAPA"}),e.jsx(U,{sx:{mt:2},children:e.jsxs(Y,{spacing:2,sx:{mt:2},children:[e.jsxs(o,{select:!0,label:"Type",name:"type",value:n.type,onChange:u,fullWidth:!0,children:[e.jsx(d,{value:"Corrective",children:"Corrective"}),e.jsx(d,{value:"Preventive",children:"Preventive"})]}),e.jsx(o,{select:!0,label:"Owner",name:"owner",value:n.owner,onChange:u,fullWidth:!0,children:w.map(t=>e.jsx(d,{value:t,children:t},t))}),e.jsx(o,{label:"Start Date",name:"startDate",type:"date",value:n.startDate,onChange:u,fullWidth:!0,InputLabelProps:{shrink:!0}}),e.jsx(o,{label:"Due Date",name:"dueDate",type:"date",value:n.dueDate,onChange:u,fullWidth:!0,InputLabelProps:{shrink:!0}}),e.jsx(o,{label:"Description",name:"description",value:n.description,onChange:u,fullWidth:!0,multiline:!0,rows:3}),e.jsxs(o,{select:!0,label:"Status",name:"status",value:n.status,onChange:u,fullWidth:!0,children:[e.jsx(d,{value:"Pending",children:"Pending"}),e.jsx(d,{value:"In Progress",children:"In Progress"}),e.jsx(d,{value:"Completed",children:"Completed"}),e.jsx(d,{value:"Overdue",children:"Overdue"})]})]})}),e.jsxs(X,{children:[e.jsx(C,{onClick:j,children:"Cancel"}),e.jsx(C,{onClick:T,variant:"contained",sx:{bgcolor:"#0A3A6E"},children:"Save CAPA"})]})]})]})};export{Ee as default};
