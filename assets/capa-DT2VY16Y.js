import{r as x,j as e,R as z}from"./index-DeCPM1YT.js";import{B as y,C as F,T as f,a as P,b as E,c as h,d as t,e as w}from"./TableRow-Cd9L6edy.js";import{C as N}from"./CardHeader-BFOCdbev.js";import{C as H}from"./CardContent-DuW-pjc9.js";import{I as g}from"./IconButton-oK9S63L7.js";import{E as V}from"./ExpandLess-BUkRJSnp.js";import{E as K}from"./ExpandMore-BjBxeS2K.js";import{C as _}from"./Collapse-CI6k5Tak.js";import{T as l}from"./TextField-RAEaaxPg.js";import{B as p}from"./Button-i0LS_vGv.js";import{C as q}from"./Chip-D7PQ2JTP.js";import{A as G}from"./AttachFile-BXFyFfNt.js";import{E as J}from"./Edit-DGiN9sfY.js";import{D as Q}from"./Delete-PXtfudQB.js";import{D as U,a as X,b as Y,c as Z}from"./DialogTitle-D5MRwTrG.js";import{S as $}from"./Stack-Cb_zqfoO.js";import{M as d}from"./MenuItem-BBKtsJ_f.js";import"./clsx-B-dksMZM.js";import"./ButtonBase-Cikulz_k.js";import"./TransitionGroupContext-CNIvG2Vj.js";import"./Transition-B84HZYJ-.js";import"./InputLabel-uQorTdpH.js";import"./Select-B0BFEktc.js";import"./index-DeXogL32.js";import"./Modal-CUDL2x5c.js";import"./isMuiElement-DPWNH1dL.js";import"./dividerClasses-ifTG4Um1.js";const Ie=()=>{const[u,m]=x.useState([{id:"INC001",category:"Near-Miss",date:"2025-10-17",location:"Site A",rca:"",capas:[]},{id:"INC002",category:"LTI",date:"2025-10-16",location:"Site B",rca:"",capas:[]}]),[C,I]=x.useState([]),[S,v]=x.useState(!1),[c,A]=x.useState(null),[a,b]=x.useState({type:"Corrective",description:"",owner:"",startDate:"",dueDate:"",cost:"",priority:"Medium",evidence:"",effectiveness:"",status:"Pending"}),k=["Ravi Kumar","Sita Das","Amit Roy","Priya Sharma","Rahul Verma"],R=["Low","Medium","High","Critical"];x.useEffect(()=>{const s=new Date;m(r=>r.map(n=>({...n,capas:n.capas.map(i=>i.status!=="Completed"&&new Date(i.dueDate)<s?{...i,status:"Overdue"}:i)})))},[]);const T=s=>{I(r=>r.includes(s)?r.filter(n=>n!==s):[...r,s])},D=(s,r=null,n=null)=>{A({incident:s,capa:r,index:n}),b(r||{type:"Corrective",description:"",owner:"",startDate:"",dueDate:"",cost:"",priority:"Medium",evidence:"",effectiveness:"",status:"Pending"}),v(!0)},j=()=>{v(!1),A(null)},o=s=>{b({...a,[s.target.name]:s.target.value})},W=()=>{const s=u.map(r=>{if(r.id===c.incident.id){let n=[...r.capas];return c.capa?n[c.index]=a:n.push(a),{...r,capas:n}}return r});m(s),j()},O=(s,r)=>{const n=u.map(i=>{if(i.id===s){const B=i.capas.filter((ee,M)=>M!==r);return{...i,capas:B}}return i});m(n)},L=s=>{switch(s){case"Completed":return"success";case"In Progress":return"warning";case"Pending":return"default";case"Overdue":return"error";default:return"default"}};return e.jsxs(y,{sx:{p:3},children:[e.jsxs(F,{sx:{borderLeft:"6px solid #0A3A6E",borderRadius:2,background:"linear-gradient(135deg, #f9fcff, #eef4ff)",boxShadow:"0 4px 20px rgba(0,0,0,0.1)"},children:[e.jsx(N,{title:e.jsx(f,{variant:"h6",sx:{color:"#0A3A6E",fontWeight:"bold"},children:"Incident Investigation & CAPA"})}),e.jsx(H,{children:e.jsxs(P,{children:[e.jsx(E,{children:e.jsxs(h,{sx:{background:"linear-gradient(135deg, #e3f2fd, #f9fcff)"},children:[e.jsx(t,{}),e.jsx(t,{sx:{fontWeight:"bold",color:"#0A3A6E"},children:"Incident ID"}),e.jsx(t,{sx:{fontWeight:"bold",color:"#0A3A6E"},children:"Category"}),e.jsx(t,{sx:{fontWeight:"bold",color:"#0A3A6E"},children:"Date"}),e.jsx(t,{sx:{fontWeight:"bold",color:"#0A3A6E"},children:"Location"}),e.jsx(t,{sx:{fontWeight:"bold",color:"#0A3A6E"},children:"CAPA Status"})," "]})}),e.jsx(w,{children:u.map(s=>e.jsxs(z.Fragment,{children:[e.jsxs(h,{children:[e.jsx(t,{children:e.jsx(g,{size:"small",onClick:()=>T(s.id),children:C.includes(s.id)?e.jsx(V,{}):e.jsx(K,{})})}),e.jsx(t,{children:s.id}),e.jsx(t,{children:s.category}),e.jsx(t,{children:s.date}),e.jsx(t,{children:s.location}),e.jsx(t,{children:s.capas.length===0?"-":s.capas.every(r=>r.status==="Completed")?"All Completed":"Pending CAPAs"})]}),e.jsx(h,{children:e.jsx(t,{colSpan:6,sx:{p:0,border:"none"},children:e.jsx(_,{in:C.includes(s.id),timeout:"auto",unmountOnExit:!0,children:e.jsxs(y,{sx:{p:2,background:"linear-gradient(135deg, #fff9f4, #fefefe)",borderRadius:2},children:[e.jsx(f,{variant:"subtitle1",sx:{fontWeight:"bold",mb:1},children:"Root Cause Analysis"}),e.jsx(l,{multiline:!0,rows:3,fullWidth:!0,value:s.rca,onChange:r=>{const n=u.map(i=>i.id===s.id?{...i,rca:r.target.value}:i);m(n)}}),e.jsx(f,{variant:"subtitle1",sx:{fontWeight:"bold",mt:2},children:"Corrective & Preventive Actions"}),e.jsx(p,{variant:"contained",sx:{mt:1,mb:1,bgcolor:"#0A3A6E",":hover":{bgcolor:"#082f5a"}},onClick:()=>D(s),children:"+ Add CAPA"}),e.jsxs(P,{size:"small",children:[e.jsx(E,{children:e.jsxs(h,{sx:{background:"#e8f5e9"},children:[e.jsx(t,{children:"Type"}),e.jsx(t,{children:"Description"}),e.jsx(t,{children:"Owner"}),e.jsx(t,{children:"Priority"}),e.jsx(t,{children:"Cost"}),e.jsx(t,{children:"Due Date"}),e.jsx(t,{children:"Status"}),e.jsx(t,{children:"Effectiveness"}),e.jsx(t,{children:"Evidence"}),e.jsx(t,{children:"Actions"})]})}),e.jsxs(w,{children:[s.capas.map((r,n)=>e.jsxs(h,{children:[e.jsx(t,{children:r.type}),e.jsx(t,{children:r.description}),e.jsx(t,{children:r.owner}),e.jsx(t,{children:r.priority}),e.jsxs(t,{children:["₹",r.cost||"-"]}),e.jsx(t,{children:r.dueDate}),e.jsx(t,{children:e.jsx(q,{label:r.status,color:L(r.status),size:"small"})}),e.jsx(t,{children:r.effectiveness||"-"}),e.jsx(t,{children:r.evidence?e.jsx(p,{size:"small",startIcon:e.jsx(G,{}),sx:{textTransform:"none"},children:"View"}):"-"}),e.jsxs(t,{children:[e.jsx(g,{size:"small",onClick:()=>D(s,r,n),children:e.jsx(J,{})}),e.jsx(g,{size:"small",onClick:()=>O(s.id,n),children:e.jsx(Q,{})})]})]},n)),s.capas.length===0&&e.jsx(h,{children:e.jsx(t,{colSpan:10,align:"center",children:"No CAPAs added."})})]})]})]})})})})]},s.id))})]})})]}),e.jsxs(U,{open:S,onClose:j,fullWidth:!0,maxWidth:"sm",children:[e.jsx(X,{sx:{bgcolor:"#0A3A6E",color:"#fff",fontWeight:"bold"},children:c!=null&&c.capa?"Edit CAPA":"Add CAPA"}),e.jsx(Y,{sx:{mt:2},children:e.jsxs($,{spacing:2,children:[e.jsxs(l,{select:!0,label:"Type",name:"type",value:a.type,onChange:o,children:[e.jsx(d,{value:"Corrective",children:"Corrective"}),e.jsx(d,{value:"Preventive",children:"Preventive"})]}),e.jsx(l,{select:!0,label:"Owner",name:"owner",value:a.owner,onChange:o,children:k.map(s=>e.jsx(d,{value:s,children:s},s))}),e.jsx(l,{select:!0,label:"Priority",name:"priority",value:a.priority,onChange:o,children:R.map(s=>e.jsx(d,{value:s,children:s},s))}),e.jsx(l,{label:"Cost (₹)",name:"cost",value:a.cost,onChange:o}),e.jsx(l,{label:"Start Date",name:"startDate",type:"date",value:a.startDate,onChange:o,InputLabelProps:{shrink:!0}}),e.jsx(l,{label:"Due Date",name:"dueDate",type:"date",value:a.dueDate,onChange:o,InputLabelProps:{shrink:!0}}),e.jsx(l,{label:"Description",name:"description",multiline:!0,rows:3,value:a.description,onChange:o}),e.jsx(l,{label:"Linked Evidence (File Name / Ref)",name:"evidence",value:a.evidence,onChange:o}),e.jsx(l,{label:"Effectiveness Check / Verification",name:"effectiveness",value:a.effectiveness,onChange:o,multiline:!0,rows:2}),e.jsxs(l,{select:!0,label:"Status",name:"status",value:a.status,onChange:o,children:[e.jsx(d,{value:"Pending",children:"Pending"}),e.jsx(d,{value:"In Progress",children:"In Progress"}),e.jsx(d,{value:"Completed",children:"Completed"}),e.jsx(d,{value:"Overdue",children:"Overdue"})]})]})}),e.jsxs(Z,{children:[e.jsx(p,{onClick:j,children:"Cancel"}),e.jsx(p,{onClick:W,variant:"contained",sx:{bgcolor:"#0A3A6E"},children:"Save CAPA"})]})]})]})};export{Ie as default};
