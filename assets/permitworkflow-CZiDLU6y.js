import{j as e,r as m}from"./index-BGNTJdXh.js";import{g as S,B as F,C as k,T as h,a as M,b as B,c as N,d as j,e as n,f as $}from"./TableRow-C4o90wkq.js";import{C as H,S as v}from"./Stack-E8fi16_w.js";import{B as c}from"./Modal-ZZY8XqvI.js";import{A as b}from"./Add-Gh8GPDgX.js";import{T as q}from"./Tooltip-DjVTl5tL.js";import{C as O}from"./Chip-DmP6IT89.js";import{I as p,D as C}from"./Delete-DvimuwFG.js";import{E as V}from"./Edit-BfV3dxxs.js";import{D as _,a as z,b as U,c as Y}from"./DialogTitle-DPXgBb11.js";import{S as J}from"./Select-F_BpfjE_.js";import{M as y}from"./MenuItem-L2i8Rv4e.js";import{A as G,a as K,b as Q}from"./AccordionSummary-qYvxoCA3.js";import{E as X}from"./ExpandMore-3plVUnV7.js";import{T as x}from"./TextField-C5AhNtWj.js";import"./clsx-B-dksMZM.js";import"./Transition-DLxW4k6f.js";import"./index-Czq5OslL.js";import"./Popper-C5oC5a0w.js";import"./Collapse-Ba7q6z5A.js";import"./InputLabel-BM8oE66Y.js";import"./isMuiElement-D3LEzrLO.js";const Z=S(e.jsx("path",{d:"m20 12-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8z"})),ee=S(e.jsx("path",{d:"m4 12 1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8z"})),re=[{id:"PTW-001",name:"Hot Work"},{id:"PTW-002",name:"Confined Space"},{id:"PTW-003",name:"Work at Height"}];function Ce(){const[u,f]=m.useState([{permitType:"Hot Work",stages:[{id:"s1",name:"Supervisor Review",role:"Supervisor",approver:"John Doe",autoApprove:!1,timeLimit:4,notes:"Check fire safety equipment",attachmentRequired:!0},{id:"s2",name:"Safety Officer Approval",role:"Safety Officer",approver:"Priya Sahoo",autoApprove:!1,timeLimit:6,notes:"Verify gas test done",attachmentRequired:!1}]}]),[T,d]=m.useState(!1),[g,A]=m.useState(null),[s,i]=m.useState({permitType:"",stages:[]}),W={id:"",name:"",role:"",approver:"",autoApprove:!1,timeLimit:0,notes:"",attachmentRequired:!1},E=()=>{A(null),i({permitType:"",stages:[]}),d(!0)},D=r=>{A(r),i({...u[r]}),d(!0)},R=r=>{window.confirm("Delete this workflow?")&&f(t=>t.filter((o,a)=>a!==r))},L=()=>{i(r=>({...r,stages:[...r.stages,{...W,id:`s${Date.now()}`}]}))},I=r=>{i(t=>({...t,stages:t.stages.filter(o=>o.id!==r)}))},w=(r,t)=>{const o=[...s.stages],a=t==="up"?r-1:r+1;a<0||a>=o.length||([o[r],o[a]]=[o[a],o[r]],i(l=>({...l,stages:o})))},P=()=>{if(!s.permitType){alert("Select a Permit Type");return}if(s.stages.length===0){alert("Add at least one stage");return}f(g!==null?r=>r.map((t,o)=>o===g?s:t):r=>[...r,s]),d(!1)};return e.jsxs(F,{sx:{p:3},children:[e.jsxs(k,{sx:{borderLeft:"6px solid #082A52",boxShadow:"0 6px 18px rgba(0,0,0,0.12)",borderRadius:2},children:[e.jsx(H,{title:e.jsx(h,{variant:"h6",sx:{color:"#0E4C92",fontWeight:600},children:"Permit Workflow & Approval Router"}),action:e.jsx(c,{variant:"contained",startIcon:e.jsx(b,{}),onClick:E,sx:{backgroundColor:"#0A3A6E"},children:"New Workflow"})}),e.jsxs(M,{children:[e.jsx(h,{variant:"body2",sx:{mb:2,color:"#334155"},children:"Define approval hierarchy for each permit type."}),e.jsxs(B,{children:[e.jsx(N,{children:e.jsxs(j,{sx:{background:"#E3F2FD"},children:[e.jsx(n,{children:"Permit Type"}),e.jsx(n,{children:"Stages"}),e.jsx(n,{align:"center",children:"Actions"})]})}),e.jsxs($,{children:[u.map((r,t)=>e.jsxs(j,{children:[e.jsx(n,{sx:{fontWeight:600},children:r.permitType}),e.jsx(n,{children:e.jsx(v,{direction:"row",spacing:1,flexWrap:"wrap",children:r.stages.map((o,a)=>e.jsx(q,{title:`Role: ${o.role}, Approver: ${o.approver}, Time Limit: ${o.timeLimit}h`,children:e.jsx(O,{label:`${a+1}. ${o.name} ${o.autoApprove?"(Auto)":"(Manual)"}`,color:o.autoApprove?"success":"default",variant:o.autoApprove?"filled":"outlined",sx:{mb:.5}})},o.id))})}),e.jsxs(n,{align:"center",children:[e.jsx(p,{color:"primary",onClick:()=>D(t),children:e.jsx(V,{})}),e.jsx(p,{color:"error",onClick:()=>R(t),children:e.jsx(C,{})})]})]},r.permitType)),u.length===0&&e.jsx(j,{children:e.jsxs(n,{colSpan:3,align:"center",sx:{py:3},children:["No workflows defined. Click ",e.jsx("b",{children:"New Workflow"}),"."]})})]})]})]})]}),e.jsxs(_,{open:T,onClose:()=>d(!1),fullWidth:!0,maxWidth:"xl",children:[e.jsx(z,{sx:{backgroundColor:"#0A3A6E",color:"white",fontWeight:600,py:3},children:g!==null?"Edit Workflow":"New Workflow"}),e.jsx(U,{dividers:!0,children:e.jsxs(v,{spacing:3,children:[e.jsxs(J,{fullWidth:!0,value:s.permitType,onChange:r=>i(t=>({...t,permitType:r.target.value})),displayEmpty:!0,children:[e.jsx(y,{value:"",children:"Select Permit Type"}),re.map(r=>e.jsx(y,{value:r.name,children:r.name},r.id))]}),e.jsxs(G,{defaultExpanded:!0,children:[e.jsx(K,{expandIcon:e.jsx(X,{}),children:e.jsxs(h,{variant:"subtitle2",children:["Approval Stages (",s.stages.length,")"]})}),e.jsxs(Q,{children:[s.stages.length===0&&e.jsx(h,{variant:"body2",sx:{color:"#64748B"},children:"No stages yet. Add one below."}),s.stages.map((r,t)=>e.jsx(k,{sx:{mb:2,border:"1px solid #E0E0E0",borderRadius:2,p:2,bgcolor:"#FAFAFA"},children:e.jsxs(v,{direction:"row",spacing:2,flexWrap:"wrap",alignItems:"center",children:[e.jsx(x,{label:"Stage Name",value:r.name,onChange:o=>{const a=[...s.stages];a[t].name=o.target.value,i(l=>({...l,stages:a}))},sx:{flex:1,minWidth:180}}),e.jsx(x,{label:"Role",value:r.role,onChange:o=>{const a=[...s.stages];a[t].role=o.target.value,i(l=>({...l,stages:a}))},sx:{flex:1,minWidth:180}}),e.jsx(x,{label:"Approver",value:r.approver,onChange:o=>{const a=[...s.stages];a[t].approver=o.target.value,i(l=>({...l,stages:a}))},sx:{flex:1,minWidth:180}}),e.jsx(x,{label:"Time Limit (hrs)",type:"number",value:r.timeLimit||"",onChange:o=>{const a=[...s.stages];a[t].timeLimit=Number(o.target.value),i(l=>({...l,stages:a}))},sx:{width:140}}),e.jsx(c,{variant:r.autoApprove?"contained":"outlined",color:r.autoApprove?"success":"inherit",onClick:()=>{const o=[...s.stages];o[t].autoApprove=!o[t].autoApprove,i(a=>({...a,stages:o}))},children:r.autoApprove?"Auto":"Manual"}),e.jsx(p,{onClick:()=>w(t,"up"),children:e.jsx(ee,{})}),e.jsx(p,{onClick:()=>w(t,"down"),children:e.jsx(Z,{})}),e.jsx(p,{color:"error",onClick:()=>I(r.id),children:e.jsx(C,{})})]})},r.id)),e.jsx(c,{startIcon:e.jsx(b,{}),variant:"outlined",onClick:L,children:"Add Stage"})]})]})]})}),e.jsxs(Y,{children:[e.jsx(c,{onClick:()=>d(!1),sx:{color:"#D32F2F"},children:"Cancel"}),e.jsx(c,{variant:"contained",onClick:P,sx:{backgroundColor:"#0A3A6E"},children:"Save Workflow"})]})]})]})}export{Ce as default};
