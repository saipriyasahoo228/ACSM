import{j as e,r as m}from"./index-DeCPM1YT.js";import{f as S,B as F,C,T as h,a as M,b as B,c as g,d as n,e as N}from"./TableRow-Cd9L6edy.js";import{C as $}from"./CardHeader-BFOCdbev.js";import{B as p}from"./Button-i0LS_vGv.js";import{A as k}from"./Add-C6u5IBut.js";import{C as H}from"./CardContent-DuW-pjc9.js";import{S as v}from"./Stack-Cb_zqfoO.js";import{T as q}from"./Tooltip-yN68D0Y6.js";import{C as O}from"./Chip-D7PQ2JTP.js";import{I as c}from"./IconButton-oK9S63L7.js";import{E as V}from"./Edit-DGiN9sfY.js";import{D as b}from"./Delete-PXtfudQB.js";import{D as _,a as z,b as U,c as Y}from"./DialogTitle-D5MRwTrG.js";import{C as J}from"./Close-DenZmEgU.js";import{S as G}from"./Select-B0BFEktc.js";import{M as y}from"./MenuItem-BBKtsJ_f.js";import{A as K,a as Q,b as X}from"./AccordionSummary-Vh4ndSVq.js";import{E as Z}from"./ExpandMore-BjBxeS2K.js";import{T as x}from"./TextField-RAEaaxPg.js";import"./clsx-B-dksMZM.js";import"./ButtonBase-Cikulz_k.js";import"./TransitionGroupContext-CNIvG2Vj.js";import"./index-DeXogL32.js";import"./Popper-CBRnQHX0.js";import"./Modal-CUDL2x5c.js";import"./Transition-B84HZYJ-.js";import"./dividerClasses-ifTG4Um1.js";import"./Collapse-CI6k5Tak.js";import"./InputLabel-uQorTdpH.js";import"./isMuiElement-DPWNH1dL.js";const ee=S(e.jsx("path",{d:"m20 12-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8z"})),re=S(e.jsx("path",{d:"m4 12 1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8z"})),oe=[{id:"PTW-001",name:"Hot Work"},{id:"PTW-002",name:"Confined Space"},{id:"PTW-003",name:"Work at Height"}];function Le(){const[u,f]=m.useState([{permitType:"Hot Work",stages:[{id:"s1",name:"Supervisor Review",role:"Supervisor",approver:"John Doe",autoApprove:!1,timeLimit:4,notes:"Check fire safety equipment",attachmentRequired:!0},{id:"s2",name:"Safety Officer Approval",role:"Safety Officer",approver:"Priya Sahoo",autoApprove:!1,timeLimit:6,notes:"Verify gas test done",attachmentRequired:!1}]}]),[T,d]=m.useState(!1),[j,A]=m.useState(null),[a,i]=m.useState({permitType:"",stages:[]}),W={id:"",name:"",role:"",approver:"",autoApprove:!1,timeLimit:0,notes:"",attachmentRequired:!1},E=()=>{A(null),i({permitType:"",stages:[]}),d(!0)},D=r=>{A(r),i({...u[r]}),d(!0)},R=r=>{window.confirm("Delete this workflow?")&&f(t=>t.filter((o,s)=>s!==r))},I=()=>{i(r=>({...r,stages:[...r.stages,{...W,id:`s${Date.now()}`}]}))},L=r=>{i(t=>({...t,stages:t.stages.filter(o=>o.id!==r)}))},w=(r,t)=>{const o=[...a.stages],s=t==="up"?r-1:r+1;s<0||s>=o.length||([o[r],o[s]]=[o[s],o[r]],i(l=>({...l,stages:o})))},P=()=>{if(!a.permitType){alert("Select a Permit Type");return}if(a.stages.length===0){alert("Add at least one stage");return}f(j!==null?r=>r.map((t,o)=>o===j?a:t):r=>[...r,a]),d(!1)};return e.jsxs(F,{sx:{p:3},children:[e.jsxs(C,{sx:{borderLeft:"6px solid #082A52",boxShadow:"0 6px 18px rgba(0,0,0,0.12)",borderRadius:2},children:[e.jsx($,{title:e.jsx(h,{variant:"h6",sx:{color:"#0E4C92",fontWeight:600},children:"Permit Workflow & Approval Router"}),action:e.jsx(p,{variant:"contained",startIcon:e.jsx(k,{}),onClick:E,sx:{backgroundColor:"#0A3A6E"},children:"New Workflow"})}),e.jsxs(H,{children:[e.jsx(h,{variant:"body2",sx:{mb:2,color:"#334155"},children:"Define approval hierarchy for each permit type."}),e.jsxs(M,{children:[e.jsx(B,{children:e.jsxs(g,{sx:{background:"#E3F2FD"},children:[e.jsx(n,{children:"Permit Type"}),e.jsx(n,{children:"Stages"}),e.jsx(n,{align:"center",children:"Actions"})]})}),e.jsxs(N,{children:[u.map((r,t)=>e.jsxs(g,{children:[e.jsx(n,{sx:{fontWeight:600},children:r.permitType}),e.jsx(n,{children:e.jsx(v,{direction:"row",spacing:1,flexWrap:"wrap",children:r.stages.map((o,s)=>e.jsx(q,{title:`Role: ${o.role}, Approver: ${o.approver}, Time Limit: ${o.timeLimit}h`,children:e.jsx(O,{label:`${s+1}. ${o.name} ${o.autoApprove?"(Auto)":"(Manual)"}`,color:o.autoApprove?"success":"default",variant:o.autoApprove?"filled":"outlined",sx:{mb:.5}})},o.id))})}),e.jsxs(n,{align:"center",children:[e.jsx(c,{color:"primary",onClick:()=>D(t),children:e.jsx(V,{})}),e.jsx(c,{color:"error",onClick:()=>R(t),children:e.jsx(b,{})})]})]},r.permitType)),u.length===0&&e.jsx(g,{children:e.jsxs(n,{colSpan:3,align:"center",sx:{py:3},children:["No workflows defined. Click ",e.jsx("b",{children:"New Workflow"}),"."]})})]})]})]})]}),e.jsxs(_,{open:T,onClose:()=>d(!1),fullWidth:!0,maxWidth:"xl",children:[e.jsxs(z,{sx:{backgroundColor:"#0A3A6E",color:"white",fontWeight:600,py:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[j!==null?"Edit Workflow":"New Workflow",e.jsx(c,{onClick:()=>d(!1),sx:{color:"#fff"},children:e.jsx(J,{})})]}),e.jsx(U,{dividers:!0,children:e.jsxs(v,{spacing:3,children:[e.jsxs(G,{fullWidth:!0,value:a.permitType,onChange:r=>i(t=>({...t,permitType:r.target.value})),displayEmpty:!0,children:[e.jsx(y,{value:"",children:"Select Permit Type"}),oe.map(r=>e.jsx(y,{value:r.name,children:r.name},r.id))]}),e.jsxs(K,{defaultExpanded:!0,children:[e.jsx(Q,{expandIcon:e.jsx(Z,{}),children:e.jsxs(h,{variant:"subtitle2",children:["Approval Stages (",a.stages.length,")"]})}),e.jsxs(X,{children:[a.stages.length===0&&e.jsx(h,{variant:"body2",sx:{color:"#64748B"},children:"No stages yet. Add one below."}),a.stages.map((r,t)=>e.jsx(C,{sx:{mb:2,border:"1px solid #E0E0E0",borderRadius:2,p:2,bgcolor:"#FAFAFA"},children:e.jsxs(v,{direction:"row",spacing:2,flexWrap:"wrap",alignItems:"center",children:[e.jsx(x,{label:"Stage Name",value:r.name,onChange:o=>{const s=[...a.stages];s[t].name=o.target.value,i(l=>({...l,stages:s}))},sx:{flex:1,minWidth:180}}),e.jsx(x,{label:"Role",value:r.role,onChange:o=>{const s=[...a.stages];s[t].role=o.target.value,i(l=>({...l,stages:s}))},sx:{flex:1,minWidth:180}}),e.jsx(x,{label:"Approver",value:r.approver,onChange:o=>{const s=[...a.stages];s[t].approver=o.target.value,i(l=>({...l,stages:s}))},sx:{flex:1,minWidth:180}}),e.jsx(x,{label:"Time Limit (hrs)",type:"number",value:r.timeLimit||"",onChange:o=>{const s=[...a.stages];s[t].timeLimit=Number(o.target.value),i(l=>({...l,stages:s}))},sx:{width:140}}),e.jsx(p,{variant:r.autoApprove?"contained":"outlined",color:r.autoApprove?"success":"inherit",onClick:()=>{const o=[...a.stages];o[t].autoApprove=!o[t].autoApprove,i(s=>({...s,stages:o}))},children:r.autoApprove?"Auto":"Manual"}),e.jsx(c,{onClick:()=>w(t,"up"),children:e.jsx(re,{})}),e.jsx(c,{onClick:()=>w(t,"down"),children:e.jsx(ee,{})}),e.jsx(c,{color:"error",onClick:()=>L(r.id),children:e.jsx(b,{})})]})},r.id)),e.jsx(p,{startIcon:e.jsx(k,{}),variant:"outlined",onClick:I,children:"Add Stage"})]})]})]})}),e.jsxs(Y,{children:[e.jsx(p,{onClick:()=>d(!1),sx:{color:"#D32F2F"},children:"Cancel"}),e.jsx(p,{variant:"contained",onClick:P,sx:{backgroundColor:"#0A3A6E"},children:"Save Workflow"})]})]})]})}export{Le as default};
